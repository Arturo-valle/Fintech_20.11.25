<div class="grid grid-cols-2 md:grid-cols-4 gap-4 items-center">
  <div class="col-span-2 md:col-span-1 flex flex-col justify-center">
    <div class="flex items-center gap-2">
      <h1 class="text-3xl font-bold text-slate-800">FintechCR</h1>
      <!-- Connection Status Indicator -->
      <div [class]="'w-3 h-3 rounded-full ' + (geminiService.hasApiKey() ? 'bg-emerald-500 animate-pulse' : 'bg-slate-300')"
           [title]="geminiService.hasApiKey() ? 'AI Connected' : 'AI Offline'">
      </div>
    </div>
    <p class="text-sm text-slate-500">Nexo Neural</p>

    <!-- API Key Toggle -->
    <button (click)="toggleApiKeyInput()" class="text-xs text-blue-600 hover:underline mt-1 text-left">
      {{ geminiService.hasApiKey() ? 'Configuración IA' : 'Conectar IA' }}
    </button>
  </div>
  
  <div class="p-4 professional-card flex items-center space-x-3">
    <svg class="w-8 h-8 text-blue-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"></path></svg>
    <div>
      <p class="text-xs text-slate-500">TPS SINPE Móvil</p>
      <p class="font-mono text-xl font-bold text-blue-600">{{ sinpeTps() }}</p>
    </div>
  </div>

  <div class="p-4 professional-card flex items-center space-x-3">
    <svg class="w-8 h-8 text-emerald-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
    <div>
      <p class="text-xs text-slate-500">Compra/Venta FX (CRC/USD)</p>
      <p class="font-mono text-xl font-bold text-emerald-600">{{ fxRate() }}</p>
    </div>
  </div>

  <div class="p-4 professional-card flex items-center space-x-3">
    <svg class="w-8 h-8 text-red-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path><path d="m9 12 2 2 4-4"></path></svg>
    <div>
      <p class="text-xs text-slate-500">Alertas de Fraude Activas</p>
      <p class="font-mono text-xl font-bold text-red-600">{{ fraudAlerts() }}</p>
    </div>
  </div>
</div>

<!-- API Key Modal / Popover -->
@if (showApiKeyInput()) {
  <div class="absolute top-20 left-4 z-50 w-72 bg-white p-4 rounded-xl shadow-xl border border-slate-200 animate-in fade-in slide-in-from-top-4">
    <h3 class="font-bold text-slate-800 mb-2">Configuración Gemini AI</h3>
    <p class="text-xs text-slate-500 mb-3">Ingresa tu API Key de Google AI Studio para activar las funciones inteligentes.</p>

    @if (!geminiService.hasApiKey()) {
      <input
        type="password"
        [ngModel]="apiKeyInput()"
        (ngModelChange)="apiKeyInput.set($event)"
        placeholder="Pegar API Key aquí..."
        class="w-full p-2 border rounded mb-3 text-sm"
      />
      <div class="flex justify-end gap-2">
        <button (click)="toggleApiKeyInput()" class="text-xs text-slate-500 hover:text-slate-700">Cancelar</button>
        <button (click)="saveApiKey()" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Conectar</button>
      </div>
    } @else {
      <div class="flex items-center gap-2 mb-3 text-emerald-600 bg-emerald-50 p-2 rounded">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
        <span class="text-xs font-medium">Sistema Conectado</span>
      </div>
      <button (click)="disconnectAI()" class="w-full px-3 py-1 bg-red-50 text-red-600 border border-red-200 rounded text-xs hover:bg-red-100">Desconectar</button>
    }
  </div>
}
